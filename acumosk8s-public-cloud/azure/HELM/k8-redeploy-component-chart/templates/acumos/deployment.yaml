# ===============LICENSE_START=======================================================
# Acumos Apache-2.0
# ===================================================================================
# Copyright (C) 2017-2018 AT&T Intellectual Property & Tech Mahindra. All rights reserved.
# ===================================================================================
# This Acumos software file is distributed by AT&T and Tech Mahindra
# under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# This file is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ===============LICENSE_END=========================================================
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
 name: acumos
 namespace: "{{ .Values.namespace }}"
 labels:
   app: acumos
spec:
 selector:
   matchLabels:
     app: acumos    
     tier: frontend
 replicas: 1
 revisionHistoryLimit: 10
 template:
   metadata:
     labels:
       app: acumos
       tier: frontend
   spec:
     containers:
       - name: onboarding-app
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosOnboardingImage }}
         ports:
           - containerPort: {{ .Values.acumosOnboardingAppPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" :{ 
                   "port" : {{ .Values.acumosOnboardingAppPort }},
                   "servlet": {
                            "context-path": "/onboarding-app"
                               }
                      },
                 "docker" : { 
                            "host" : "{{ .Values.acumosDockerHost }}.{{ .Values.namespace }}",
                            "port": {{ .Values.acumosDockerPort }} ,
                            "config": "/docker_host/.docker",
                            "registry" :{"url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}/",
                            "username" : "{{ .Values.acumosNexusUsername }}",
                            "password" : "{{ .Values.acumosNexusPassword }}", 
                            "email": "{{ .Values.acumosDockerRegistryEmail }}"},
                            "tls": { "verify": "false" }, 
                            "api": { "version": "1.23" },
                            "imagetag":{
                                "prefix": "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}" 
                                    },
                            "max_total_connections":  "1", "max_per_route_connections": "1" 
                            },
                 "http_proxy": "http://{{ .Values.acumosProxy }}.{{ .Values.namespace }}:{{ .Values.acumosProxyPort }}",
                 "nexus": {
                            "nexusEndPointURL": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "{{ .Values.acumosNexusUsername }}",
                            "nexusPassword": "{{ .Values.acumosNexusPassword }}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                 "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                                "cmnDataSvcUser": "{{ .Values.acumosCdsUser }}",
                                "cmnDataSvcPwd": "{{ .Values.acumosCdsPassword }}" 
                               },
                 "tosca": {
                            "OutputFolder" : "/temp/",
                            "GeneratorEndPointURL": "http://acumos.acumos-ns01:8080/model_create" 
                          },
                 "mktPlace": {
                              "mktPlaceEndPointURL" : "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPortalBePort }}"  
                              },
                 "microService": {
                     "microServiceEndPointURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosMicroServiceGenerationPort }}/microservice-generation"
                   },
                 "requirements": { 
                                  "extraIndexURL": "",
                                  "trustedHost": "" 
                                 }, 
                 "authenticationServiceURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPortalBePort }}",
                 "spring": {
                     "servlet": {
                       "multipart": {
                          "max-file-size": "-1",
                          "max-request-size": "-1"
                       }
                     }
                   },
                 "base_image": { "rimage": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosOnboardingBaseRImage }}","dockerusername": "{{ .Values.acumosDockerUsername }}","dockerpassword": "{{ .Values.acumosDockerPassword }}"}                   
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output
       - name: microservice-generation
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosMicroServiceGenerationImage }}
         ports:
           - containerPort: {{ .Values.acumosMicroServiceGenerationPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{
                   "server":{
                     "port": {{ .Values.acumosMicroServiceGenerationPort }},
                     "servlet": {
                         "context-path": "/microservice-generation"
                               }
                   },
                   "docker": {
                     "host": "{{ .Values.acumosDockerHost }}.{{ .Values.namespace }}",
                     "port": "{{ .Values.acumosDockerPort }}",
                     "config": "/docker_host/.docker",
                     "registry" :{"url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}/",
                     "username" : "{{ .Values.acumosNexusUsername }}",
                     "password" : "{{ .Values.acumosNexusPassword }}", 
                     "email": "{{ .Values.acumosDockerRegistryEmail }}"},
                     "tls": {
                       "verify": "false"
                     },
                     "api": {
                       "version": "1.23"
                     },
                     "imagetag": {
                       "prefix": "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}"
                     },
                     "max_total_connections": "1",
                     "max_per_route_connections": "1"
                   },
                   "http_proxy": "http://{{ .Values.acumosProxy }}.{{ .Values.namespace }}:{{ .Values.acumosProxyPort }}",
                   "nexus": {
                            "nexusEndPointURL": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "{{ .Values.acumosNexusUsername }}",
                            "nexusPassword": "{{ .Values.acumosNexusPassword }}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                   "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                                "cmnDataSvcUser": "{{ .Values.acumosCdsUser }}",
                                "cmnDataSvcPwd": "{{ .Values.acumosCdsPassword }}" 
                               },
                   "mktPlace": {
                     "mktPlaceEndPointURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPortalBePort }}"
                   },
                   "microService": {
                     "microServiceEndPointURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosMicroServiceGenerationPort }}/microservice-generation",
                     "microServiceAsyncFlag": "false"
                   },
                   "requirements": {
                     "extraIndexURL": "",
                     "trustedHost": ""
                   },
                   "base_image": {
                     "rimage": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosOnboardingBaseRImage }}",
                     "dockerusername": "{{ .Values.acumosDockerUsername }}",
                     "dockerpassword": "{{ .Values.acumosDockerPassword }}"
                   },
                   "spring": {
                     "servlet": {
                       "multipart": {
                          "max-file-size": "-1",
                          "max-request-size": "-1"
                       }
                     }
                   }
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output
       - name: kubernetes-client
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosKubernetesClientImage }}
         ports:
           - containerPort: {{ .Values.acumosKubernetesClientPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{
                   "kube" : {
                      "incrementPort": "8557",
                      "singleModelPort": "{{ .Values.acumosDataBrokerPort }}",
                      "folderPath": "/maven/home",
                      "singleTargetPort": "{{ .Values.acumosDeployedSolutionPort }}",
                      "dataBrokerModelPort": "{{ .Values.acumosDataBrokerPort }}",
                      "dataBrokerTargetPort": "{{ .Values.acumosDataBrokerPort }}",
                      "mlTargetPort": "{{ .Values.acumosDeployedSolutionPort }}",
                      "nginxImageName": "nginx",
                      "nexusEndPointURL": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/"
                    },
                   "dockerproxy": {
                    "host": "{{ .Values.acumosDockerProxyHost }}",
                    "port": "{{ .Values.acumosDockerProxyPort }}"
                    },
                   "blueprint": {
                      "port": "{{ .Values.acumosBluePrintPort }}",
                      "ImageName": "{{ .Values.acumosBluePrintOrchestratorImage }}",
                      "name": "blueprint-orchestrator"
                     },
                   "nexus": {
                            "nexusEndPointURL": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "{{ .Values.acumosNexusUsername }}",
                            "nexusPassword": "{{ .Values.acumosNexusPassword }}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                   "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                                "cmnDataSvcUser": "{{ .Values.acumosCdsUser }}",
                                "cmnDataSvcPwd": "{{ .Values.acumosCdsPassword }}" 
                               },
                   "probe": {
                               "probeImageName": "{{ .Values.acumosProtoViewerImage }}",
                               "probeImagePORT": "{{ .Values.acumosProbePort }}",
                               "probeModelPort": "{{ .Values.acumosProbePort }}",
                               "probeTargetPort": "{{ .Values.acumosProbePort }}",
                               "probeApiPort": "{{ .Values.acumosProbePort }}",
                               "probeSchemaPort": "80"
                             }
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs            
       - name: acumos-portal-be
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosPortalBeImage }}
         ports:
           - containerPort: {{ .Values.acumosPortalBePort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : {
                   "port" : {{ .Values.acumosPortalBePort }}
                },
                "nexus": {
                        "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven",
                        "proxy": "",
                        "password": "{{ .Values.acumosNexusPassword }}",
                        "username": "{{ .Values.acumosNexusUsername }}",
                        "groupid": "com.artifact"
                },
                "cdms" : {
                  "client" : {
                     "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                     "username": "{{ .Values.acumosCdsUser }}",
                     "password": "{{ .Values.acumosCdsPassword }}"
                     }
                },
                "docker" : {
                   "host" : "{{ .Values.acumosDockerHost }}.{{ .Values.namespace }}",
                   "resgistry" : {
                      "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}/",
                      "username" : "{{ .Values.acumosNexusUsername }}",
                      "password" : "{{ .Values.acumosNexusPassword }}",
                      "email": "admin@acumos.com"
                   },
                   "imagetag" : {
                       "prefix": "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}"
                   }
                },
                "qanda" : {
                   "url" : "https://{{ .Values.acumosQandAUrl }}"
                },
                "image" : {
                   "size" : "800KB"
                },
                "onboarding" : {
                   "push" : {
                       "model" : {
                          "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosOnboardingAppPort }}/onboarding-app/v2/models",
                          "dcae_url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosMicroServiceGenerationPort }}/microservice-generation/v2/generateMicroservice"
                          },
                         "advancedmodel" : {
                                   "url" : "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosOnboardingAppPort }}/onboarding-app/v2/advancedModel"
                               }
                       },
	              "cliPushUrl": "http://{{ .Values.acumosOnboardingCli }}:{{ .Values.acumosOnboardingAppPort }}/onboarding-app/v2/push",
                      "cliAuthUrl": "http://{{ .Values.acumosOnboardingCli }}:{{ .Values.acumosOnboardingAppPort }}/onboarding-app/v2/auth",
                      "tokenmode": "apiToken"
                   },
                "model" : {
                   "storage" : {
                      "folder" : {
                         "name" : "/acumosWebOnboarding"
                      }
                   }
                },
                "microservice" : {
                   "url" : "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosMicroServiceGenerationPort }}/microservice-generation/v2/generateMicroservice"
                },
                "doc" : {
                   "url" : "https://wiki.acumos.org"
                },
                "document" : {
                   "size" : 10000000
                },
                "jupyter" : {
                   "url" : "https://acumos.{{ .Values.namespace }}:8086"
                },
                "kubernetes" : {
                   "doc" : {
                      "url" : "http://docs.acumos.org/"
                   }
                },
                "portal" : {
                   "mailjet" : {
                      "api" : {
                         "key" : "{{ .Values.acumosMailJetApiKey }}"
                      },
                      "secret" : {
                         "key" : "{{ .Values.acumosMailJetSecretKey }}"
                      },
                      "address" : {
                         "from" : "{{ .Values.acumosMailJetId }}"
                      }
                   },
                   "feature" : {
                      "publishSelfRequestEnabled" : "true",
                      "enablePublication" : "true",
                      "email_service" : "mailjet",
                      "cas_enabled" : "false",
                      "verifyAccount": "false",
                      "verifyToken": {
                          "exp_time": 24  
                        },
                      "ds" :{
                      "menu" : "{\"isWorkbenchActive\":false,\"isAcucomposeActive\":true,\"blocks\":[{\"active\":false,\"title\":\"Demo\",\"description\":\"Sample block\",\"url\":\"http://acumos.{{ .Values.namespace }}:8085/index.html#/home\"}]}"
                    },		
                      "sv" : {
                         "enabled" : "false",
                         "api" : " http://acumos.{{ .Values.namespace }}:{{ .Values.acumosSecurityVerificationPort }}/scan"
                      },
                      "menu" : "[{\"name\" : \"ML Learning Path\", \"url\" : \"\", \"imagePath\" : \"/images/sidebar-icons/ML_learning_path_selected.png\" }]",
                      "cloud_enabled" : "[{\"cloudEnabled\" : \"true\", \"cloudName\" : \"azure\", \"cloudDisplayText\" : \"Microsoft Azure\", \"imageUrl\": \"/images/deploy-cloud/microsoft_azure.png\" },{ \"cloudEnabled\" : \"false\", \"cloudName\" : \"rackspace\", \"cloudDisplayText\" : \"Rackspace\", \"imageUrl\": \"/images/deploy-cloud/rackspace.png\" },{ \"cloudEnabled\" : \"false\",  \"cloudName\" : \"gcp\", \"cloudDisplayText\" : \"Google Cloud Platform\", \"imageUrl\": \"/images/deploy-cloud/google_cloud_platform.png\" },{ \"cloudEnabled\" : \"true\",  \"cloudName\" : \"deploylocal\", \"cloudDisplayText\" : \"Deploy To Local\", \"imageUrl\": \"/images/deploy-cloud/deploy_to_local.png\" },{ \"cloudEnabled\" : \"false\",  \"cloudName\" : \"whitebox\", \"cloudDisplayText\" : \"Deploy To White Box\", \"imageUrl\": \"/images/deploy-cloud/deploy_to_whitebox.png\" }]"
                   },
                   "ui" : {
                      "server" : {
                           "address" : "https://{{ .Values.acumosHostname }}"
                      }
                   },                   
                   "dashboard":{
                       "url" : "http://{{ .Values.acumosELKHost }}:{{ .Values.acumosKibanaPort }}"
                   }
                  },                 
                "client" : {
                   "ssl" : {
                      "key-store" : "/app/certs/acumos-k8s.pkcs12",
                      "key-store-password" : "{{ .Values.acumosKeyStorePwd }}",
                      "key-store-type" : "PKCS12",
                      "key-password" : "{{ .Values.acumosKeyStorePwd }}",
                      "trust-store" : "/app/certs/acumosTrustStore.jks",
                      "trust-store-password" : "{{ .Values.acumosTrustStorePwd }}"
                   }
                 },
                 "gateway" : {
                    "url" : "https://acumos.acumos-ns01:{{ .Values.acumosFederationLocalPort }}"
                 },
                 "dcae" : {
                    "model" : {
                       "name" : {
                          "prefix" : "ONAP"
                       }
                    }
                },
                "jwt" : {
                   "auth" : {
                      "timeout" : "80000000"
                   }
                },
                 "cas"  : {
                    "service" : {
                       "validate" : {
                            "url"  : "https://identity.linuxfoundation.org/cas/serviceValidate"
                       }
                    }
                } }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs
           - mountPath: /acumosWebOnboarding
             name: acumos-webonboarding                
       - name: acumos
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosPortalFeImage }}
         ports:
          - containerPort: {{ .Values.acumosPortalFePort }}
            name: acumos
         env:
           - name: ACUMOS_DB_HOST
             value: acumos-mysql.{{ .Values.namespace }}
           - name: ACUMOS_DB_PASSWORD
             value: {{ .Values.acumosMariaDbRootPassword }}
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : {
                    "port" : {{ .Values.acumosPortalFePort }}
                },
               "qanda" : {
                        "url" : "https://stackoverflow.com/questions/tagged/acumos"
                    },
               "zuul" : {
                   "routes" : {
                      "api" : {
                        "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPortalBePort }}"
                      },
                      "dsce": {
                        "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPortalDsCompositionPort }}"
                      },
                      "cmnt" : {
                         "url" : "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosPlatOnPort }}"
                      },
                      "workbench" : {
                         "path" : "/workbench/**",
                         "url" : "http://acumos.{{ .Values.namespace }}:9087",
                         "sensitiveHeaders" : ""
                      },
                      "azure" : {
                          "url" : "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosAzureClientPort }}"
                      },
                      "openstack" : {
                          "path": "/openstack/**",
                          "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosOpenStackClientPort }}",
                          "stripPrefix": "false",
                          "sensitiveHeaders": ""
                        },
                      "package": {
                          "path": "/package/**",
                          "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosKubernetesClientPort }}",
                          "stripPrefix": "true",
                          "sensitiveHeaders": ""
                        }
                   },
                   "host" : {
                      "connect-timeout-millis" : 300000,
                      "socket-timeout-millis" : 300000
                   }
               },
               "spring" : {
                  "http" : {
                     "multipart" : {
                        "max-file-size": -1,
                        "max-request-size": -1
                     }
                  }
               }
               }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs               
       - name: notebook-catalog-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosNotebookCatalogWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosNotebookCatalogWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"
           - name: ENVIRONMENT
             value: "deploy"
           - name: PROJECTMSURL
             value: "http://acumos.{{ .Values.namespace }}:9088/mlWorkbench/v1/project"
           - name: NOTEBOOKMSURL
             value: "http://acumos.{{ .Values.namespace }}:9089/mlWorkbench/v1/notebook"
           - name: PIPELINEMSURL
             value: "http://acumos.{{ .Values.namespace }}:9090/mlWorkbench/v1/pipeline"
           - name: NOTEBOOKWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs            	 
       - name: home-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosHomeWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosHomeWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"		 
           - name: ENVIRONMENT
             value: "deploy"
           - name: DASHBOARDCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9083"
           - name: PROJECTCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9084"
           - name: PROJECTCATALOGCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9085"
           - name: NOTEBOOKCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9093"
           - name: NOTEBOOKCATALOGCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9094"
           - name: PIPELINECOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9091"
           - name: PIPELINECATALOGCOMPONENT
             value: "http://acumos.{{ .Values.namespace }}:9092"
           - name: PORTALFEURL
             value: "http://acumos.{{ .Values.namespace }}"
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs			 
       - name: project-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosProjectWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosProjectWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"		 
           - name: ENVIRONMENT
             value: "deploy"
           - name: PROJECTMSURL
             value: "http://acumos.{{ .Values.namespace }}:9088/mlWorkbench/v1/project"
           - name: NOTEBOOKMSURL
             value: "http://acumos.{{ .Values.namespace }}:9089/mlWorkbench/v1/notebook"
           - name: PIPELINEMSURL
             value: "http://acumos.{{ .Values.namespace }}:9090/mlWorkbench/v1/pipeline"
           - name: PROJECTWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
           - name: NOTEBOOKWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
           - name: PIPELINEWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs			 
       - name: dashboard-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosDashboardWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosDashboardWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"		 
           - name: ENVIRONMENT
             value: "deploy"
           - name: PROJECTMSURL
             value: "http://acumos.{{ .Values.namespace }}:9088/mlWorkbench/v1/project"
           - name: NOTEBOOKMSURL
             value: "http://acumos.{{ .Values.namespace }}:9089/mlWorkbench/v1/notebook"
           - name: PIPELINEMSURL
             value: "http://acumos.{{ .Values.namespace }}:9090/mlWorkbench/v1/pipeline"
           - name: PORTALFEURL
             value: "http://acumos.{{ .Values.namespace }}"
           - name: PORTALBEURL
             value: "http://acumos.{{ .Values.namespace }}:8083"			 
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs			 
       - name: project-catalog-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosProjectCatalogWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosProjectCatalogWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"		 
           - name: ENVIRONMENT
             value: "deploy"
           - name: PROJECTMSURL
             value: "http://acumos.{{ .Values.namespace }}:9088/mlWorkbench/v1/project"
           - name: NOTEBOOKMSURL
             value: "http://acumos.{{ .Values.namespace }}:9089/mlWorkbench/v1/notebook"
           - name: PIPELINEMSURL
             value: "http://acumos.{{ .Values.namespace }}:9090/mlWorkbench/v1/pipeline"
           - name: PROJECTWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs			 
       - name: notebook-webcomponent
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosNotebookWebComponentImage }}
         ports:
           - containerPort: {{ .Values.acumosNotebookWebComponentPort }}
         env:
           - name: ES_JAVA_OPTS
             value: "-Xmx256m -Xms256m"
           - name: ENVIRONMENT
             value: "deploy"
           - name: NOTEBOOKMSURL
             value: "http://acumos.{{ .Values.namespace }}:9089/mlWorkbench/v1/notebook"
           - name: NOTEBOOKWIKIURL
             value: "https://wiki.acumos.org/display/TRAIN"
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
       - name:  ds-compositionengine
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosDesignStudioImage }}
         ports:
           - containerPort: {{ .Values.acumosPortalDsCompositionPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server": {
                    "port": {{ .Values.acumosPortalDsCompositionPort }} 
                    },
                    "dateformat": "yyyy-MM-dd-HH-mm-ss-SSS",
                    "solutionResultsetSize": "2000",
                    "gdmJarName":"gdmservice-1.2.0.jar",
                    "cdsCheckInterval": 20000,
                    "cdsCheckAttempt": 7,
                    "imagedatabrokerURI":"{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosDataBrokerImage }}",
                    "csvdatabrokerURI":"{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosCsvDataBrokerImage }}",                    
                    "sqldatabrokerURI": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosSqlDataBrokerImage }}",
                    "jsondatabrokerURI": "NA",
                    "lib":"/maven/",
                    "tosca": { "outputfolder": "/temp/output/" },
                "nexus": { 
                         "nexusendpointurl": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                         "nexusproxy": "",
                         "nexuspassword": "{{ .Values.acumosNexusPassword }}",
                         "nexususername": "{{ .Values.acumosNexusUsername }}",
                         "nexusgroupid": "com.artifact" 
                         },
                "cmndatasvc": { 
                              "cmndatasvcendpoinurl": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                              "cmndatasvcuser": "{{ .Values.acumosCdsUser }}",
                              "cmndatasvcpwd": "{{ .Values.acumosCdsPassword }}" 
                              },
                "docker": {
                           "host": "{{ .Values.acumosDockerHost }}.{{ .Values.namespace }}",
                           "port": {{ .Values.acumosDockerPort }},
                           "config": "/docker_host/.docker",
                           "registry": {
                                        "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}/",
                                        "username": "{{ .Values.acumosNexusUsername }}",
                                        "password": "{{ .Values.acumosNexusPassword }}",
                                        "email": "{{ .Values.acumosDockerRegistryEmail }}"
                                            },
                            "tls": {"verify": "false"},
                            "api": {"version": "1.23"},
                            "imagetag": {
                                        "prefix": "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}"
                                            },
                            "max_total_connections": "1",
                            "max_per_route_connections": "1"
                            } }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output
#       - name: sv-scanning
#         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosSecurityVerificationImage }}
#         securityContext:
#           privileged: true
#         env:
#           - name: ACUMOS_ADMIN_USER
#             value: "admin"
#           - name: ACUMOS_CDS_HOST
#             value: "acumos.{{ .Values.namespace }}"
#           - name: ACUMOS_CDS_PORT
#             value: "{{ .Values.acumosCommonDataSvcPort }}"
#           - name: ACUMOS_CDS_USER
#             value: "{{ .Values.acumosCdsUser }}"
#           - name: ACUMOS_CDS_PASSWORD
#             value: "{{ .Values.acumosCdsPassword }}"
#           - name: ACUMOS_NEXUS_HOST
#             value: "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}"
#           - name: ACUMOS_NEXUS_API_PORT
#             value: "{{ .Values.acumosNexusEndpointPort }}"
#           - name: ACUMOS_NEXUS_MAVEN_REPO
#             value: "acumos-k8-models-maven"
#           - name: SPRING_APPLICATION_JSON
#             value: '{
#             "server" : {
#                   "port" : {{ .Values.acumosSecurityVerificationPort }}
#            },
#            "cdms": {
#              "client": {
#                 "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
#                 "username": "{{ .Values.acumosCdsUser }}",
#                 "password": "{{ .Values.acumosCdsPassword }}",
#                 "host": "acumos.{{ .Values.namespace }}",
#                 "port": "8000"
#              }
#            },
#            "nexus": {
#               "nexusendpointurl": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
#               "nexusproxy": "",
#               "nexuspassword": "{{ .Values.acumosNexusPassword }}",
#               "nexususername": "{{ .Values.acumosNexusUsername }}",
#               "nexusgroupid": "com.artifact"
#                }
#            },
#            "siteConfig": "{
#              "verification": {
#                "externalScan": "false",
#                "allowedLicense": [
#                  { "type": "SPDX", "value": "Apache-2.0" },
#                  { "type": "SPDX", "value": "CC-BY-4.0" },
#                  { "type": "SPDX", "value": "BSD-3-Clause" },
#                  { "type": "VendorA", "value": "Vendor-A-OSS" },
#                  { "type": "CompanyB", "value": "CompanyB-Proprietary" }
#                ],
#                "licenseScan": {
#                  "created": "true",
#                  "updated": "true",
#                  "deploy": "false",
#                  "download": "false",
#                  "share": "false",
#                  "publishCompany": "false",
#                  "publishPublic": "false"
#                },
#                "securityScan": {
#                  "created": "true",
#                  "updated": "true",
#                  "deploy": "false",
#                  "download": "false",
#                  "share": "false",
#                  "publishCompany": "false",
#                  "publishPublic": "false"
#                },
#                "licenseVerify": {
#                  "deploy": "true",
#                  "download": "true",
#                  "share": "false",
#                  "publishCompany": "true",
#                  "publishPublic": "true"
#                },
#                "securityVerify": {
#                  "deploy": "true",
#                  "download": "true",
#                  "share": "false",
#                  "publishCompany": "true",
#                  "publishPublic": "true"
#                }
#              }
#            }"
#          }'
#         ports:
#           - containerPort: {{ .Values.acumosSecurityVerificationPort }}
#         volumeMounts:
#           - mountPath: /maven/logs
#             name: acumos-logs 
       - name:  common-data-svc
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosCdsImage }}
         ports:
           - containerPort: {{ .Values.acumosCommonDataSvcPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : { 
                 "port" : {{ .Values.acumosCommonDataSvcPort }} },
                "spring" : { 
                            "datasource" : {
                                        "jdbc-url" : "jdbc:mariadb://acumos-mysql.{{ .Values.namespace }}:{{ .Values.acumosMariaDbPort }}/{{ .Values.acumosCdsDb }}?useLegacyDatetimeCode=false&useSSL=false",
                                        "username" : "{{ .Values.acumosMariaDbUser }}",
                                        "password" : "{{ .Values.acumosMariaDbPassword }}"
                                        },
                            "jpa" : {
                                    "database-platform" : "org.hibernate.dialect.MariaDB102Dialect",
                                     "hibernate" : { 
                                            "ddl-auto" : "validate" 
                                             },
                                          "show-sql" : false
                                     },
                             "security" : {
                             "user" : {
                                      "name": "{{ .Values.acumosCdsUser }}",
                                      "password": "{{ .Values.acumosCdsPassword }}"
                                      }
                             }
 
                             }
                     }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs                     
       - name: azure-client
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosAzureClientImage }}
         ports:
           - containerPort: {{ .Values.acumosAzureClientPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ 
                    "server": {
                      "port": "{{ .Values.acumosAzureClientPort }}"
                    },
                    "docker": {
                      "containerNamePrefix": "{{ .Values.acumosAzureContainerNamePrefix }}",
                      "host": "{{ .Values.acumosDockerHost }}.{{ .Values.namespace }}",
                      "port": "{{ .Values.acumosDockerPort }}",
                      "dockerVMUserName": "{{ .Values.acumosDeployedVMUser }}",
                      "dockerVMPassword": "{{ .Values.acumosDeployedVMPassword }}",
                      "replaceChar": "^",
                      "ignordoller": "TRUE",
                      "solutionPort": "{{ .Values.acumosDeployedSolutionPort }}",
                      "subnet": "{{ .Values.acumosAzureSubnet }}",
                      "vnet": "{{ .Values.acumosAzureVnet }}",
                      "sleepTimeFirst": "30000",
                      "sleepTimeSecond": "50000",
                      "nexusRegistyUserName": "{{ .Values.acumosRWUserName }}",
                      "nexusRegistyPwd": "{{ .Values.acumosRWUserPassword }}",
                      "nexusRegistyName": "{{ .Values.nexus3RegistryName }}",
                      "otherRegistyName": "",
                      "nginxMapFolder": "/home/artifacts",
                      "nginxWebFolder": "/usr/share/nginx/html",
                      "nginxImageName": "nginx:latest",
                      "nginxInternalPort": "80",
                      "exposeDataBrokerPort": "{{ .Values.acumosDataBrokerPort }}",
                      "internalDataBrokerPort": "{{ .Values.acumosDataBrokerInternalPort }}",
                      "registry": {
                        "bluePrint": {
                          "username": "{{ .Values.acumosRWUserName }}",
                          "password": "{{ .Values.acumosRWUserPassword }}"
                        },
                        "probe": {
                          "username": "{{ .Values.acumosRWUserName }}",
                          "password": "{{ .Values.acumosRWUserPassword }}"
                        },
                        "networkgroupName": "{{ .Values.acumosAzureNetworkGroupName }}",
                        "port": "80",
                        "name": "{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}",
                        "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusPort }}/",
                        "username": "{{ .Values.acumosNexusUsername }}",
                        "password": "{{ .Values.acumosNexusPassword }}"
                      }
                    },
                    "blueprint": {
                      "ImageName": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosBluePrintOrchestratorImage }}",
                      "name": "blueprint-orchestrator"
                    },
                    "nexus": {
                      "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                      "nexusproxy": "NA",
                      "password": "{{ .Values.acumosNexusPassword }}",
                      "username": "{{ .Values.acumosNexusUsername }}",
                      "groupId": "com.artifact"
                    },
                    "cmndatasvc": {
                      "cmndatasvcendpoinurl": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                      "cmndatasvcuser": "{{ .Values.acumosCdsUser }}",
                      "cmndatasvcpwd": "{{ .Values.acumosCdsPassword }}"
                    },
                    "probe": {
                      "ImageName": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosProtoViewerImage }}",
                      "name": "proto_viewer",
                      "internalPort": "{{ .Values.acumosProbePort }}",
                      "probeNexusEndPoint": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven"
                    }
                  }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
       - name: acumos-openstack-client
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosOpenStackImage }}
         ports:
           - containerPort: {{ .Values.acumosOpenStackClientPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ 
                    "server": {
                      "port": "{{ .Values.acumosOpenStackClientPort }}"
                    },
                    "docker": {
                        "openstack": {
                        "flavourName": "e6emedium",
                        "securityGroupName": "{{ .Values.acumosSecurityGroupName }}",
                        "endpoint": "http://{{ .Values.acumosOpenStackEndpoint }}/identity/v3",
                        "userName": "{{ .Values.acumosOpenStackEndpointUsername }}",
                        "password": "{{ .Values.acumosOpenStackEndpointPassword }}",
                        "scopeProject": "7badda19df524dd58c2fe249fd02e7f6",
                        "IdentifierName": "Default",
                        "key": "e6e-key",
                        "keyName": "/maven/home/e6e-key.pem",
                        "vmRegisterNumber": "2600",
                        "hostOpenStack": "{{ .Values.acumosOpenStackEndpoint }}",
                        "hostUserName": "{{ .Values.acumosOpenStackHostUsername }}",
                        "vmUserName": "{{ .Values.acumosOpenStackVMUsername }}",
                        "dockerUserName": "{{ .Values.acumosNexusUsername }}",
                        "dockerPassword": "{{ .Values.acumosNexusPassword }}",
                        "bluePrintName": "blueprint-orchestrator",
                        "bluePrintImageName": "{{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosBluePrintOrchestratorImage }}",
                        "bluePrintUserName": "{{ .Values.acumosDockerUsername }}",
                        "bluePrintPassword": "{{ .Values.acumosDockerPassword }}",
                        "solutionPort":"{{ .Values.acumosOpenStackSolutionPort }}",
                        "Sleeptime":"180000",
                        "proxyIP":"{{ .Values.acumosOpenStackProxyIp }}",
                        "proxyPort":"{{ .Values.acumosProxyPort }}",
                        "openStackIP":"{{ .Values.acumosOpenStackEndpoint }}",
                        "bluePrintPortNumber":"{{ .Values.acumosBluePrintPort }}"
                         }
                    },
                    "nexus": {
                      "url": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
                      "nexusproxy": "NA",
                      "password": "{{ .Values.acumosNexusPassword }}",
                      "username": "{{ .Values.acumosNexusUsername }}",
                      "groupId": "com.artifact"
                    },
                    "cmndatasvc": {
                      "cmndatasvcendpoinurl": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                      "cmndatasvcuser": "{{ .Values.acumosCdsUser }}",
                      "cmndatasvcpwd": "{{ .Values.acumosCdsPassword }}"
                    }
                  }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs             
       - name: filebeat
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosFilebeatImage }}
         ports:
           - containerPort: {{ .Values.acumosFilebeatPort }}
         env:
           - name: LOGSTASH_HOST
             value: {{ .Values.acumosLogstashHost }}.{{ .Values.namespace }}
           - name: LOGSTASH_PORT
             value: "{{ .Values.acumosLogstashPort }}"
         volumeMounts:
           - mountPath: /filebeat-logs
             name: acumos-logs             
       - name:  federation-gateway
         image: {{ .Values.nexus3ReleaseRegistryLf }}/{{ .Values.acumosFederationImage }}
         ports:
           - containerPort: {{ .Values.acumosFederationGatewayPort }}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "federation" : {
               "instance" : "gateway",
               "instance.name" : "k8",
               "operator" : "d468656f-57d0-46e3-9f94-7ffa4f66dc03",
               "address" : "0.0.0.0",
               "server" : {
                 "port" : {{ .Values.acumosFederationGatewayPort }}
               },
               "ssl" : {
                 "key-store" : "/app/certs/acumos-k8s.pkcs12",
                 "key-store-password" : "{{ .Values.acumosKeyStorePwd }}",
                 "key-store-type" : "PKCS12",
                 "key-password" : "{{ .Values.acumosKeyStorePwd }}",
                 "trust-store" : "/app/certs/acumosTrustStore.jks",
                 "trust-store-password" : "{{ .Values.acumosTrustStorePwd }}"
               }
             },
             "local" : {
               "address": "0.0.0.0",
               "server": {
                 "port" : {{ .Values.acumosFederationLocalPort }}
               },
               "ssl" : {
                 "key-store" : "/app/certs/acumos-k8s.pkcs12",
                 "key-store-password" : "{{ .Values.acumosKeyStorePwd }}",
                 "key-store-type" : "PKCS12",
                 "key-password" : "{{ .Values.acumosKeyStorePwd }}",
                 "trust-store" : "/app/certs/acumosTrustStore.jks",
                 "trust-store-password" : "{{ .Values.acumosTrustStorePwd }}"
               }
             },
             "nexus": {
               "nexusendpointurl": "http://{{ .Values.acumosNexusService }}.{{ .Values.namespace }}:{{ .Values.acumosNexusEndpointPort }}/repository/acumos-k8-models-maven/",
               "nexusproxy": "",
               "nexuspassword": "{{ .Values.acumosNexusPassword }}",
               "nexususername": "{{ .Values.acumosNexusUsername }}",
               "nexusgroupid": "com.artifact"
             },
             "peer": {
               "jobchecker": {
                 "interval": 300
               }
             },
             "cdms" : {
               "client" : {
                 "url": "http://acumos.{{ .Values.namespace }}:{{ .Values.acumosCommonDataSvcPort }}/ccds",
                 "username": "{{ .Values.acumosCdsUser }}",
                 "password": "{{ .Values.acumosCdsPassword }}"
               }
             }}'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs
     volumes:
       - name: acumos-logs
         persistentVolumeClaim:
           claimName: acumos-volumeclaim
       - name: acumos-output
         persistentVolumeClaim:
           claimName: acumos-output-volumeclaim
       - name: acumos-certs
         persistentVolumeClaim:
           claimName: acumos-certs-volumeclaim
       - name: acumos-webonboarding
         persistentVolumeClaim:
           claimName: acumos-webonboarding-volumeclaim
     imagePullSecrets:
       - name: acumossecret