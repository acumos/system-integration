# ===============LICENSE_START=======================================================
# Acumos Apache-2.0
# ===================================================================================
# Copyright (C) 2017-2018 AT&T Intellectual Property & Tech Mahindra. All rights reserved.
# ===================================================================================
# This Acumos software file is distributed by AT&T and Tech Mahindra
# under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# This file is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ===============LICENSE_END=========================================================
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
 name: acumos
 namespace: ${ACUMOS_NAMESPACE}
 labels:
   app: acumos
spec:
 selector:
   matchLabels:
     app: acumos    
     tier: frontend
 replicas: 1
 template:
   metadata:
     labels:
       app: acumos
       tier: frontend
   spec:
     containers:
       - name: onboarding-app
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_ONBOARDING_IMAGE}
         ports:
           - containerPort: ${ACUMOS_ONBOARDING_APP_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" :{ 
                   "port" : ${ACUMOS_ONBOARDING_APP_PORT} 
                 },
                 "docker" : { 
                            "host" : "${ACUMOS_DOCKER_HOST}.${ACUMOS_NAMESPACE}",
                            "port": ${ACUMOS_DOCKER_PORT} ,
                            "config": "/docker_host/.docker",
                            "registry" :{"url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}/",
                            "username" : "${ACUMOS_NEXUS_USERNAME}",
                            "password" : "${ACUMOS_NEXUS_PASSWORD}", 
                            "email": "${ACUMOS_DOCKER_REGISTRY_EMAIL}"},
                            "tls": { "verify": "false" }, 
                            "api": { "version": "1.23" },
                            "imagetag":{
                                "prefix": "${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}" 
                                    },
                            "max_total_connections":  "1", "max_per_route_connections": "1" 
                            },
                 "http_proxy": "http://${ACUMOS_PROXY}.${ACUMOS_NAMESPACE}:${ACUMOS_PROXY_PORT}",
                 "nexus": {
                            "nexusEndPointURL": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "${ACUMOS_NEXUS_USERNAME}",
                            "nexusPassword": "${ACUMOS_NEXUS_PASSWORD}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                 "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                                "cmnDataSvcUser": "${ACUMOS_CDS_USER}",
                                "cmnDataSvcPwd": "${ACUMOS_CDS_PASSWORD}" 
                               },
                 "tosca": {
                            "OutputFolder" : "/temp/",
                            "GeneratorEndPointURL": "http://acumos.acumos-ns01:8080/model_create" 
                          },
                 "mktPlace": {
                              "mktPlaceEndPointURL" : "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}"  
                              },
                 "microService": {
                     "microServiceEndPointURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_MICROSERVICE_GENERATION_PORT}/microservice-generation"
                   },
                 "requirements": { 
                                  "extraIndexURL": "",
                                  "trustedHost": "" 
                                 }, 
                 "authenticationServiceURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}",
                 "spring": {
                     "http": {
                       "multipart": {
                          "max-file-size": "1024MB",
                          "max-request-size": "1024MB"
                       }
                     }
                   },
                 "base_image": { "rimage": "${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_ONBOARDING_BASE_R}","dockerusername": "${ACUMOS_DOCKER_USERNAME}","dockerpassword": "${ACUMOS_DOCKER_PASSWORD}"}                   
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output
       - name: microservice-generation
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_MICROSERVICE_GENERATION_IMAGE}
         ports:
           - containerPort: ${ACUMOS_MICROSERVICE_GENERATION_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{
                   "server":{
                     "port": ${ACUMOS_MICROSERVICE_GENERATION_PORT}
                   },
                   "docker": {
                     "host": "${ACUMOS_DOCKER_HOST}.${ACUMOS_NAMESPACE}",
                     "port": "${ACUMOS_DOCKER_PORT}",
                     "config": "/docker_host/.docker",
                     "registry" :{"url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}/",
                     "username" : "${ACUMOS_NEXUS_USERNAME}",
                     "password" : "${ACUMOS_NEXUS_PASSWORD}", 
                     "email": "${ACUMOS_DOCKER_REGISTRY_EMAIL}"},
                     "tls": {
                       "verify": "false"
                     },
                     "api": {
                       "version": "1.23"
                     },
                     "imagetag": {
                       "prefix": "${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}"
                     },
                     "max_total_connections": "1",
                     "max_per_route_connections": "1"
                   },
                   "http_proxy": "http://${ACUMOS_PROXY}.${ACUMOS_NAMESPACE}:${ACUMOS_PROXY_PORT}",
                   "nexus": {
                            "nexusEndPointURL": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "${ACUMOS_NEXUS_USERNAME}",
                            "nexusPassword": "${ACUMOS_NEXUS_PASSWORD}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                   "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                                "cmnDataSvcUser": "${ACUMOS_CDS_USER}",
                                "cmnDataSvcPwd": "${ACUMOS_CDS_PASSWORD}" 
                               },
                   "mktPlace": {
                     "mktPlaceEndPointURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}"
                   },
                   "microService": {
                     "microServiceEndPointURL": "http://acumos.${ACUMOS_NAMESPACE}:8091"
                   },
                   "requirements": {
                     "extraIndexURL": "",
                     "trustedHost": ""
                   },
                   "base_image": {
                     "rimage": "${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_ONBOARDING_BASE_R}",
                     "dockerusername": "${ACUMOS_DOCKER_USERNAME}",
                     "dockerpassword": "${ACUMOS_DOCKER_PASSWORD}"
                   },
                   "spring": {
                     "http": {
                       "multipart": {
                          "max-file-size": "1024MB",
                          "max-request-size": "1024MB"
                       }
                     }
                   }
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output
       - name: kubernetes-client
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_KUBERNETES_CLIENT_IMAGE}
         ports:
           - containerPort: ${ACUMOS_KUBERNETES_CLIENT_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{
                   "kube" : {
                      "incrementPort": "8557",
                      "singleModelPort": "${ACUMOS_DATA_BROKER_PORT}",
                      "folderPath": "/maven/home",
                      "singleTargetPort": "${ACUMOS_DEPLOYED_SOLUTION_PORT}",
                      "dataBrokerModelPort": "${ACUMOS_DATA_BROKER_PORT}",
                      "dataBrokerTargetPort": "${ACUMOS_DATA_BROKER_PORT}",
                      "mlTargetPort": "${ACUMOS_DEPLOYED_SOLUTION_PORT}",
                      "nginxImageName": "nginx",
                      "nexusEndPointURL": "http://localhost:80"
                    },
                   "dockerproxy": {
                    "host": "${ACUMOS_DOCKER_PROXY_HOST}",
                    "port": "${ACUMOS_DOCKER_PROXY_PORT}"
                    },
                   "blueprint": {
                      "port": "${ACUMOS_BLUEPRINT_PORT}",
                      "ImageName": "${ACUMOS_BLUE_PRINT_ORCHESTRATOR}",
                      "name": "blueprint-orchestrator"
                     },
                   "nexus": {
                            "nexusEndPointURL": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                            "nexusUserName": "${ACUMOS_NEXUS_USERNAME}",
                            "nexusPassword": "${ACUMOS_NEXUS_PASSWORD}",
                            "nexusproxy": "",
                            "nexusGroupId": "com.artifact" 
                           },
                   "cmndatasvc": {
                                "cmnDataSvcEndPoinURL": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                                "cmnDataSvcUser": "${ACUMOS_CDS_USER}",
                                "cmnDataSvcPwd": "${ACUMOS_CDS_PASSWORD}" 
                               },
                   "probe": {
                               "probeImageName": "${ACUMOS_PROTO_VIEWER}",
                               "probeImagePORT": "${ACUMOS_PROBE_PORT}",
                               "probeModelPort": "${ACUMOS_PROBE_PORT}",
                               "probeTargetPort": "${ACUMOS_PROBE_PORT}",
                               "probeApiPort": "${ACUMOS_PROBE_PORT}",
                               "probeSchemaPort": "80"
                             }
                 }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs            
       - name: acumos-portal-be
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_PORTAL_BE_IMAGE}
         ports:
           - containerPort: ${ACUMOS_PORTAL_BE_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : {
                   "port" : ${ACUMOS_PORTAL_BE_PORT}
                },
                "nexus": {
                        "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven",
                        "proxy": "",
                        "password": "${ACUMOS_NEXUS_PASSWORD}",
                        "username": "${ACUMOS_NEXUS_USERNAME}",
                        "groupid": "com.artifact"
                },
                "cdms" : {
                  "client" : {
                     "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                     "username": "${ACUMOS_CDS_USER}",
                     "password": "${ACUMOS_CDS_PASSWORD}"
                     }
                },
                "docker" : {
                   "host" : "${ACUMOS_DOCKER_HOST}.${ACUMOS_NAMESPACE}",
                   "resgistry" : {
                      "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}/",
                      "username" : "${ACUMOS_NEXUS_USERNAME}",
                      "password" : "${ACUMOS_NEXUS_PASSWORD}",
                      "email": "admin@acumos.com"
                   },
                   "imagetag" : {
                       "prefix": "${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}"
                   }
                },
                "qanda" : {
                   "url" : "https://${ACUMOS_QANDA_URL}"
                },
                "onboarding" : {
                   "push" : {
                       "model" : {
                          "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_ONBOARDING_APP_PORT}/onboarding-app/v2/models",
                          "dcae_url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_ONBOARDING_APP_PORT}/onboarding-app/v2/dcae_models"
                       },                      
                      "cliPushUrl": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_ONBOARDING_APP_PORT}/onboarding-app/v2/push",
                      "cliAuthUrl": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_ONBOARDING_APP_PORT}/onboarding-app/v2/auth",
                      "tokenmode": "jwtToken"
                   },
                "model" : {
                   "storage" : {
                      "folder" : {
                         "name" : "/acumosWebOnboarding"
                      }
                   }
                },
                "doc" : {
                   "url" : "https://wiki.acumos.org"
                },
                "portal" : {
                   "mailjet" : {
                      "api" : {
                         "key" : "${ACUMOS_MAILJET_API_KEY}"
                      },
                      "secret" : {
                         "key" : "${ACUMOS_MAILJET_SECRET_KEY}"
                      },
                      "address" : {
                         "from" : "${ACUMOS_MAILJET_ID}"
                      }
                   },
                   "feature" : {
                      "validateModel" : "false",
                      "email_service" : "mailjet",
                      "cas_enabled" : "false",
                      "download_bufferSize": 8,
                      "signup_enabled": "true",
                      "verifyAccount": "false",
                        "verifyToken": {
                          "exp_time": 24  
                        }
                   },
                   "cloud_enabled": "[{\"cloudEnabled\": \"true\", \"cloudName\": \"azure\", \"cloudDisplayText\": \"Microsoft Azure\", \"imageUrl\": \"/images/deploy-cloud/microsoft_azure.png\" },{ \"cloudEnabled\": \"true\", \"cloudName\": \"rackspace\", \"cloudDisplayText\": \"Rackspace\", \"imageUrl\": \"/images/deploy-cloud/rackspace.png\" },{ \"cloudEnabled\": \"false\",  \"cloudName\": \"gcp\", \"cloudDisplayText\": \"Google Cloud Platform\", \"imageUrl\": \"/images/deploy-cloud/google_cloud_platform.png\" },{ \"cloudEnabled\": \"true\",  \"cloudName\": \"deploylocal\", \"cloudDisplayText\": \"Deploy To Local\", \"imageUrl\": \"/images/deploy-cloud/deploy_to_local.png\" },{ \"cloudEnabled\": \"false\", \"cloudName\": \"whitebox\", \"cloudDisplayText\": \"Deploy To White Box\", \"imageUrl\": \"/images/deploy-cloud/deploy_to_whitebox.png\" }]"
                   },
                   "submitValidation" : {
                       "api" : "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_PORT}/status/v1.0/tasks"
                   },
                   "dashboard":{
                       "url" : "http://${ACUMOS_HOSTNAME}:${ACUMOS_KIBANA_PORT}"
                   }                
                },
                 "spring": {
                      "mail": {
                        "template": {
                          "folder": {
                            "path": "/fmtemplates/"
                          }
                        } 
                      }
                    },
                "client" : {
                   "ssl" : {
                      "key-store" : "/app/certs/acumos-k8s.pkcs12",
                      "key-store-password" : "${ACUMOS_KEY_STORE_PWD}",
                      "key-store-type" : "PKCS12",
                      "key-password" : "${ACUMOS_KEY_STORE_PWD}",
                      "trust-store" : "/app/certs/acumosTrustStore.jks",
                      "trust-store-password" : "${ACUMOS_TRUST_STORE_PWD}"
                   }
                 },
                 "gateway" : {
                    "url" : "https://acumos.acumos-ns01:${ACUMOS_FEDERATION_LOCAL_PORT}"
                 },
                 "dcae" : {
                    "model" : {
                       "name" : {
                          "prefix" : "ONAP"
                       }
                    }
                },
                 "cas"  : {
                    "service" : {
                       "validate" : {
                            "url"  : "https://identity.linuxfoundation.org/cas/serviceValidate"
                       }
                    }
                } }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs
           - mountPath: /acumosWebOnboarding
             name: acumos-webonboarding                
       - name: acumos
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_PORTAL_FE_IMAGE}
         ports:
          - containerPort: ${ACUMOS_PORTAL_FE_PORT}
            name: acumos
         env:
           - name: ACUMOS_DB_HOST
             value: acumos-mysql.${ACUMOS_NAMESPACE}
           - name: ACUMOS_DB_PASSWORD
             value: ${ACUMOS_MARIADB_ROOT_PASSWORD}
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : {
                    "port" : ${ACUMOS_PORTAL_FE_PORT}
                },
               "zuul" : {
                   "routes" : {
                      "api" : {
                        "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}"
                      },
                      "dsce": {
                        "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_DS_COMPOSITION_PORT}"
                      },
                      "site" : {
                        "url": "http://acumos.${ACUMOS_NAMESPACE}:9080"
                      },
                      "cmnt" : {
                         "url" : "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PLATON_PORT}"
                      },
                      "azure" : {
                          "url" : "http://acumos.${ACUMOS_NAMESPACE}:9081"
                      },
                      "openstack" : {
                          "path": "/openstack/**",
                          "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_OPENSTACK_CLIENT_PORT}",
                          "stripPrefix": "false",
                          "sensitiveHeaders": ""
                        },
                      "package": {
                          "path": "/package/**",
                          "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_KUBERNETES_CLIENT_PORT}",
                          "stripPrefix": "true",
                          "sensitiveHeaders": ""
                        }
                   },
                   "host" : {
                      "connect-timeout-millis" : 300000,
                      "socket-timeout-millis" : 300000
                   }
               },
               "spring" : {
                  "http" : {
                     "multipart" : {
                        "max-file-size": -1,
                        "max-request-size": -1
                     }
                  }
               }
               }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs               
       - name:  acumos-cms-docker
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_CMS_IMAGE}
         ports:
          - containerPort: 9080
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : {
                    "port" : 9080
                },
                "spring" : {
                    "datasource" : {
                        "url" : "jdbc:mysql://acumos-mysql.${ACUMOS_NAMESPACE}:${ACUMOS_MARIADB_PORT}/${ACUMOS_CMS_DB}?useSSL=false",
                        "username" : "${ACUMOS_CMS_USER}",
                        "password" : "${ACUMOS_CMS_PASSWORD}"
                  }
                },
                "parameters": {
                   "repository" : {
                      "dataSource" : {
                         "url" : "jdbc:mysql://acumos-mysql.${ACUMOS_NAMESPACE}:${ACUMOS_MARIADB_PORT}/${ACUMOS_CMS_DB}?useSSL=false",
                         "username" : "${ACUMOS_CMS_USER}",
                         "password" : "${ACUMOS_CMS_PASSWORD}"
                      }
                   }
                } }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs                
       - name:  ds-compositionengine
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_DESIGN_STUDIO_IMAGE}
         ports:
           - containerPort: ${ACUMOS_PORTAL_DS_COMPOSITION_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server": {
                    "port": ${ACUMOS_PORTAL_DS_COMPOSITION_PORT} 
                    },
                    "dateformat": "yyyy-MM-dd-HH-mm-ss-SSS",
                    "solutionResultsetSize": "2000",
                    "cdsCheckInterval": 10000,
                    "cdsCheckAttempt": 4,
                    "imagedatabrokerURI":"${NEXUS3_STAGING_REGISTRY_LF}/${ACUMOS_DATA_BROKER_IMAGE}",
                    "csvdatabrokerURI":"${NEXUS3_STAGING_REGISTRY_LF}/${ACUMOS_CSV_DATA_BROKER_IMAGE}",                    
                    "sqldatabrokerURI": "${NEXUS3_STAGING_REGISTRY_LF}/${ACUMOS_SQL_DATA_BROKER_IMAGE}",
                    "jsondatabrokerURI": "NA",
                    "lib":"/maven/",
                    "tosca": { "outputfolder": "/temp/output/" },
                "nexus": { 
                         "nexusendpointurl": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                         "nexusproxy": "",
                         "nexuspassword": "${ACUMOS_NEXUS_PASSWORD}",
                         "nexususername": "${ACUMOS_NEXUS_USERNAME}",
                         "nexusgroupid": "com.artifact" 
                         },
                "cmndatasvc": { 
                              "cmndatasvcendpoinurl": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                              "cmndatasvcuser": "${ACUMOS_CDS_USER}",
                              "cmndatasvcpwd": "${ACUMOS_CDS_PASSWORD}" 
                              },
                "docker": {
                           "host": "${ACUMOS_DOCKER_HOST}.${ACUMOS_NAMESPACE}",
                           "port": ${ACUMOS_DOCKER_PORT},
                           "config": "/docker_host/.docker",
                           "registry": {
                                        "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}/",
                                        "username": "${ACUMOS_NEXUS_USERNAME}",
                                        "password": "${ACUMOS_NEXUS_PASSWORD}",
                                        "email": "${ACUMOS_DOCKER_REGISTRY_EMAIL}"
                                            },
                            "tls": {"verify": "false"},
                            "api": {"version": "1.23"},
                            "imagetag": {
                                        "prefix": "${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}"
                                            },
                            "max_total_connections": "1",
                            "max_per_route_connections": "1"
                            } }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /temp
             name: acumos-output                            
       - name:  common-data-svc
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_CDS_IMAGE}
         ports:
           - containerPort: ${ACUMOS_COMMON_DATA_SVC_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "server" : { 
                 "port" : ${ACUMOS_COMMON_DATA_SVC_PORT} },
                 "security" : {
                             "user" : {
                                      "name": "${ACUMOS_CDS_USER}", 
                                      "password": "${ACUMOS_CDS_PASSWORD}"
                                      }
                             },
                "spring" : { 
                           "database" : { 
                                      "driver" : { "classname" : "org.mariadb.jdbc.Driver"} 
                                        },
                            "datasource" : {
                                        "url" : "jdbc:mysql://acumos-mysql.${ACUMOS_NAMESPACE}:${ACUMOS_MARIADB_PORT}/${ACUMOS_CDS_DB}?useSSL=false",
                                        "username" : "${ACUMOS_MARIADB_USER}",
                                        "password" : "${ACUMOS_MARIADB_PASSWORD}"
                                        },
                            "jpa" : {
                                    "database-platform" : "org.hibernate.dialect.MySQLDialect",
                                     "hibernate" : { 
                                            "ddl-auto" : "validate" 
                                             }
                                     } 
                             }
                     }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs                     
       - name: azure-client
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_AZURE_CLIENT_IMAGE}
         ports:
           - containerPort: 9081
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ 
                    "server": {
                      "port": "9081"
                    },
                    "docker": {
                      "containerNamePrefix": "${ACUMOS_AZURE_CONTAINER_NAME_PREFIX}",
                      "host": "${ACUMOS_DOCKER_HOST}.${ACUMOS_NAMESPACE}",
                      "port": "${ACUMOS_DOCKER_PORT}",
                      "dockerVMUserName": "${ACUMOS_DEPLOYED_VM_USER}",
                      "dockerVMPassword": "${ACUMOS_DEPLOYED_VM_PASSWORD}",
                      "replaceChar": "^",
                      "ignordoller": "TRUE",
                      "solutionPort": "${ACUMOS_DEPLOYED_SOLUTION_PORT}",
                      "subnet": "${ACUMOS_AZURE_SUBNET}",
                      "vnet": "${ACUMOS_AZURE_VNET}",
                      "sleepTimeFirst": "30000",
                      "sleepTimeSecond": "50000",
                      "nexusRegistyUserName": "${ACUMOS_RW_USER_NAME}",
                      "nexusRegistyPwd": "${ACUMOS_RW_USER_PASSWORD}",
                      "nexusRegistyName": "${NEXUS3_REGISTRY_NAME}",
                      "otherRegistyName": "",
                      "nginxMapFolder": "/home/artifacts",
                      "nginxWebFolder": "/usr/share/nginx/html",
                      "nginxImageName": "nginx:latest",
                      "nginxInternalPort": "80",
                      "exposeDataBrokerPort": "${ACUMOS_DATA_BROKER_PORT}",
                      "internalDataBrokerPort": "${ACUMOS_DATA_BROKER_INTERNAL_PORT}",
                      "registry": {
                        "bluePrint": {
                          "username": "${ACUMOS_RW_USER_NAME}",
                          "password": "${ACUMOS_RW_USER_PASSWORD}"
                        },
                        "probe": {
                          "username": "${ACUMOS_RW_USER_NAME}",
                          "password": "${ACUMOS_RW_USER_PASSWORD}"
                        },
                        "networkgroupName": "${ACUMOS_AZURE_NETWORK_GROUP_NAME}",
                        "port": "80",
                        "name": "${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}",
                        "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_PORT}/",
                        "username": "${ACUMOS_NEXUS_USERNAME}",
                        "password": "${ACUMOS_NEXUS_PASSWORD}"
                      }
                    },
                    "blueprint": {
                      "ImageName": "${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_BLUE_PRINT_ORCHESTRATOR}",
                      "name": "blueprint-orchestrator"
                    },
                    "nexus": {
                      "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                      "nexusproxy": "NA",
                      "password": "${ACUMOS_NEXUS_PASSWORD}",
                      "username": "${ACUMOS_NEXUS_USERNAME}",
                      "groupId": "com.artifact"
                    },
                    "cmndatasvc": {
                      "cmndatasvcendpoinurl": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                      "cmndatasvcuser": "${ACUMOS_CDS_USER}",
                      "cmndatasvcpwd": "${ACUMOS_CDS_PASSWORD}"
                    },
                    "probe": {
                      "ImageName": "${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_PROTO_VIEWER}",
                      "name": "proto_viewer",
                      "internalPort": "${ACUMOS_PROBE_PORT}",
                      "probeNexusEndPoint": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven"
                    }
                  }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
       - name: acumos-openstack-client
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_OPENSTACK}
         ports:
           - containerPort: ${ACUMOS_OPENSTACK_CLIENT_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ 
                    "server": {
                      "port": "${ACUMOS_OPENSTACK_CLIENT_PORT}"
                    },
                    "docker": {
                        "openstack": {
                        "flavourName": "e6emedium",
                        "securityGroupName": "${ACUMOS_SECURITY_GROUP_NAME}",
                        "endpoint": "http://${ACUMOS_OPENSTACK_ENDPOINT}/identity/v3",
                        "userName": "${ACUMOS_OPENSTACK_ENDPOINT_USERNAME}",
                        "password": "${ACUMOS_OPENSTACK_ENDPOINT_PASSWORD}",
                        "scopeProject": "7badda19df524dd58c2fe249fd02e7f6",
                        "IdentifierName": "Default",
                        "key": "e6e-key",
                        "keyName": "/maven/home/e6e-key.pem",
                        "vmRegisterNumber": "2600",
                        "hostOpenStack": "${ACUMOS_OPENSTACK_ENDPOINT}",
                        "hostUserName": "${ACUMOS_OPENSTACK_HOST_USERNAME}",
                        "vmUserName": "${ACUMOS_OPENSTACK_VM_USERNAME}",
                        "dockerUserName": "${ACUMOS_NEXUS_USERNAME}",
                        "dockerPassword": "${ACUMOS_NEXUS_PASSWORD}",
                        "bluePrintName": "blueprint-orchestrator",
                        "bluePrintImageName": "${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_BLUE_PRINT_ORCHESTRATOR}",
                        "bluePrintUserName": "${ACUMOS_DOCKER_USERNAME}",
                        "bluePrintPassword": "${ACUMOS_DOCKER_PASSWORD}",
                        "solutionPort":"${ACUMOS_OPENSTACK_SOLUTION_PORT}",
                        "Sleeptime":"180000",
                        "proxyIP":"${ACUMOS_OPENSTACK_PROXY_IP}",
                        "proxyPort":"${ACUMOS_PROXY_PORT}",
                        "openStackIP":"${ACUMOS_OPENSTACK_ENDPOINT}",
                        "bluePrintPortNumber":"${ACUMOS_BLUEPRINT_PORT}"
                         }
                    },
                    "nexus": {
                      "url": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
                      "nexusproxy": "NA",
                      "password": "${ACUMOS_NEXUS_PASSWORD}",
                      "username": "${ACUMOS_NEXUS_USERNAME}",
                      "groupId": "com.artifact"
                    },
                    "cmndatasvc": {
                      "cmndatasvcendpoinurl": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                      "cmndatasvcuser": "${ACUMOS_CDS_USER}",
                      "cmndatasvcpwd": "${ACUMOS_CDS_PASSWORD}"
                    }
                  }'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs             
       - name: filebeat
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_FILEBEAT_IMAGE}
         ports:
           - containerPort: ${ACUMOS_FILEBEAT_PORT}
         env:
           - name: LOGSTASH_HOST
             value: ${ACUMOS_LOGSTASH_HOST}
           - name: LOGSTASH_PORT
             value: "${ACUMOS_LOGSTASH_PORT}"
         volumeMounts:
           - mountPath: /filebeat-logs
             name: acumos-logs
       - name: validation-client
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_VALIDATION_CLIENT}
         ports:
           - containerPort: ${ACUMOS_VALIDATION_PORT}
         env:
           - name: URL_CCDS
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds/config/site_config
           - name: URL_PORTAL
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/validation
           - name: APP_NAME
             value: ValidationAndSecurity
           - name: URL_INVOKE_TASK
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_ENGINE_PORT}/invoketask
           - name: URL_TASK_STATUS
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_ENGINE_PORT}/status
           - name: URL_TODO_TASK
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_MIDDLEWARE_PORT}/todo/api/v1.0/tasks
           - name: URL_SITE_CONFIG
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/admin/config
           - name: URL_ONBOARDING_CONTROLLER
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/webBasedOnBoarding/stepResult/create
           - name: IGNORE_LIST_CHECK
             value: Disable             
         volumeMounts:
           - mountPath: /validation-client-logs
             name: acumos-logs
       - name: validation-middleware
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_VALIDATION_MIDDLEWARE}
         ports:
           - containerPort: ${ACUMOS_VALIDATION_MIDDLEWARE_PORT}
         env:
           - name: URL_CCDS
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds/config/site_config
           - name: URL_PORTAL
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/validation
           - name: APP_NAME
             value: ValidationAndSecurity
           - name: URL_INVOKE_TASK
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_ENGINE_PORT}/invoketask
           - name: URL_TASK_STATUS
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_ENGINE_PORT}/status
           - name: URL_SITE_CONFIG
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/admin/config
           - name: URL_ONBOARDING_CONTROLLER
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/webBasedOnBoarding/stepResult/create
           - name: IGNORE_LIST_CHECK
             value: Disable             
         volumeMounts:
           - mountPath: /validation-middleware-logs
             name: acumos-logs
       - name: validation-engine
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_VALIDATION_ENGINE}
         ports:
           - containerPort: ${ACUMOS_VALIDATION_ENGINE_PORT}
         env:
           - name: URL_CCDS
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds/config/site_config
           - name: URL_PORTAL
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/validation
           - name: APP_NAME
             value: ValidationAndSecurity
           - name: URL_TODO_TASK
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_VALIDATION_MIDDLEWARE_PORT}/todo/api/v1.0/tasks
           - name: URL_SITE_CONFIG
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/admin/config
           - name: URL_ONBOARDING_CONTROLLER
             value: http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_PORTAL_BE_PORT}/webBasedOnBoarding/stepResult/create
           - name: IGNORE_LIST_CHECK
             value: Disable
           - name: CCDS_USERNAME
             value: ${ACUMOS_CDS_USER}
           - name: CCDS_PASSWORD
             value: ${ACUMOS_CDS_PASSWORD}             
         volumeMounts:
           - mountPath: /validation-engine-logs
             name: acumos-logs             
       - name:  federation-gateway
         image: ${NEXUS3_RELEASE_REGISTRY_LF}/${ACUMOS_FEDERATION_IMAGE}
         ports:
           - containerPort: ${ACUMOS_FEDERATION_GATEWAY_PORT}
         env:
           - name: SPRING_APPLICATION_JSON
             value: '{ "federation" : {
               "instance" : "gateway",
               "instance.name" : "k8",
               "operator" : "d468656f-57d0-46e3-9f94-7ffa4f66dc03",
               "address" : "0.0.0.0",
               "server" : {
                 "port" : ${ACUMOS_FEDERATION_GATEWAY_PORT}
               },
               "ssl" : {
                 "key-store" : "/app/certs/acumos-k8s.pkcs12",
                 "key-store-password" : "${ACUMOS_KEY_STORE_PWD}",
                 "key-store-type" : "PKCS12",
                 "key-password" : "${ACUMOS_KEY_STORE_PWD}",
                 "trust-store" : "/app/certs/acumosTrustStore.jks",
                 "trust-store-password" : "${ACUMOS_TRUST_STORE_PWD}"
               }
             },
             "local" : {
               "address": "0.0.0.0",
               "server": {
                 "port" : ${ACUMOS_FEDERATION_LOCAL_PORT}
               },
               "ssl" : {
                 "key-store" : "/app/certs/acumos-k8s.pkcs12",
                 "key-store-password" : "${ACUMOS_KEY_STORE_PWD}",
                 "key-store-type" : "PKCS12",
                 "key-password" : "${ACUMOS_KEY_STORE_PWD}",
                 "trust-store" : "/app/certs/acumosTrustStore.jks",
                 "trust-store-password" : "${ACUMOS_TRUST_STORE_PWD}"
               }
             },
             "nexus": {
               "nexusendpointurl": "http://${ACUMOS_NEXUS_SERVICE}.${ACUMOS_NAMESPACE}:${ACUMOS_NEXUS_ENDPOINT_PORT}/repository/acumos-k8-models-maven/",
               "nexusproxy": "",
               "nexuspassword": "${ACUMOS_NEXUS_PASSWORD}",
               "nexususername": "${ACUMOS_NEXUS_USERNAME}",
               "nexusgroupid": "com.artifact"
             },
             "peer": {
               "jobchecker": {
                 "interval": 300
               }
             },
             "cdms" : {
               "client" : {
                 "url": "http://acumos.${ACUMOS_NAMESPACE}:${ACUMOS_COMMON_DATA_SVC_PORT}/ccds",
                 "username": "${ACUMOS_CDS_USER}",
                 "password": "${ACUMOS_CDS_PASSWORD}"
               }
             }}'
         volumeMounts:
           - mountPath: /maven/logs
             name: acumos-logs
           - mountPath: /app/certs
             name: acumos-certs
     volumes:
       - name: acumos-logs
         persistentVolumeClaim:
           claimName: acumos-volumeclaim
       - name: acumos-output
         persistentVolumeClaim:
           claimName: acumos-output-volumeclaim
       - name: acumos-certs
         persistentVolumeClaim:
           claimName: acumos-certs-volumeclaim
       - name: acumos-webonboarding
         persistentVolumeClaim:
           claimName: acumos-webonboarding-volumeclaim
     imagePullSecrets:
       - name: acumossecret
